var margin={top:20,right:50,bottom:30,left:50},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,parseDate=d3.time.format("%Y-%m-%d").parse,x=d3.time.scale().range([0,width]),yVisitsScale=d3.scale.linear().range([height,0]),yConvScale=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yVisitsAxis=d3.svg.axis().scale(yVisitsScale).orient("left"),yConvAxis=d3.svg.axis().scale(yConvScale).orient("right"),visitsLine=d3.svg.line().interpolate("basis").x(function(n){return x(n.day)}).y(function(n){return yVisitsScale(n.visits)}),convLine=d3.svg.line().interpolate("basis").x(function(n){return x(n.day)}).y(function(n){return yConvScale(n.subscribers/n.visits)}),svgG=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("/wapp155/wapp155.csv",function(n){console.log(n),n.forEach(function(n){n.day=parseDate(n.day),n.visits=+n.visits,n.subscribers=+n.subscribers}),console.log(n),x.domain(d3.extent(n,function(n){return n.day})),yVisitsScale.domain([0,d3.max(n,function(n){return n.visits})]),yConvScale.domain([0,d3.max(n,function(n){return n.subscribers/n.visits})]),svgG.datum(n),svgG.append("path").attr("class","line").attr("d",visitsLine),svgG.append("path").attr("class","line conversion").attr("d",convLine),svgG.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),svgG.append("g").attr("class","y axis").call(yVisitsAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Visits"),svgG.append("g").attr("class","y axis conversion").attr("transform","translate("+width+",0)").call(yConvAxis).append("text").attr("transform","rotate(-90)").attr("y",-10).attr("dy",".71em").style("text-anchor","end").text("Conversion")})