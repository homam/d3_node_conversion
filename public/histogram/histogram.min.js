var margin={top:10,right:30,bottom:30,left:30},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,parseDate=d3.time.format("%m/%d/%Y %H:%M:%S").parse,xAxisDateFormat=d3.time.format("%H:%M"),epoch=parseDate("1/12/2013 00:00:00"),epochPlus1=parseDate("1/13/2013 00:00:00"),render;d3.csv("/histogram/visits-f.csv?",function(n){var t=n.map(function(n){return parseDate(n.Visit).valueOf()-epoch.valueOf()}),i=d3.scale.linear().domain(d3.extent(t)).range([0,width]),u,r,f,e;window.x=i,u=d3.range(0,25,1).map(function(n){return n*36e5}),r=d3.layout.histogram().bins(u)(t),window.datav=r,t=n.filter(function(n){return n.Sub!="NULL"}).map(function(n){return parseDate(n.Sub)}).filter(function(n){return n>=epoch&&n<=epochPlus1}).map(function(n){return n.valueOf()-epoch.valueOf()}),f=d3.layout.histogram().bins(u)(t),window.datas=e,e=f.map(function(n,t){return{y:n.y/r[t].y,x:n.x,dx:n.dx}}),render(r,i,d3.format(",.0f")),render(f,i,d3.format(",.0f")),render(e,i,function(n){return Math.floor(n*1e3)/10+"%"})}),render=function(n,t,i){var r=d3.scale.linear().domain([0,d3.max(n,function(n){return n.y})]).range([height,0]),e=d3.svg.axis().scale(t).ticks(25).orient("bottom").tickFormat(function(n){return xAxisDateFormat(new Date(epoch.valueOf()+n))}),o=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),u=o.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),f=u.selectAll(".bar").data(n).enter().append("g").attr("class","bar").attr("transform",function(n){return"translate("+t(n.x)+","+r(n.y)+")"});f.append("rect").attr("x",1).attr("width",t(n[0].dx)-1).attr("height",function(n){return height-r(n.y)}),f.append("text").attr("dy",".75em").attr("y",6).attr("x",t(n[0].dx)/2).attr("text-anchor","middle").text(function(n){return i(n.y)}),u.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(e)}