var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Dashboard;(function(n){(function(t){function r(t){t.load().done(function(t){var r=d3.scale.linear().domain([d3.min(t,function(n){return n.Visits}),d3.max(t,function(n){return n.Visits})]),f=d3.time.scale().domain(d3.extent(t,function(n){return n.day})),e=_.groupBy(t,function(n){return n.Ref});_.chain(e).map(function(n,t){return n.key=t,n}).filter(function(n){return _(n).map(function(n){return n.Visits}).reduce(function(n,t){return n+t},0)>200}).each(function(t){var e=new u(t);new i(e,new n.Growth.MovingAverageDataSmoother(7),r,t.key,f)})})}t.DrawByRef=r;var u=function(n){function t(t){n.call(this,null),this.data=t}return __extends(t,n),t.prototype.loadRawData=function(){var n=$.Deferred();return n.resolve(this.data),n},t.prototype.load=function(){return this.loadRawData()},t}(t.DataLoader),i=function(n){function t(t,i,r,u,f){this.visitsScale=r,this.referrer=u,this.xScale=f,n.call(this,t,i,"body",null,null,300)}return __extends(t,n),t.prototype.loadAndRaw=function(){var n=this;this.loader.load().done(function(t){!n.smoother||(t=n.smoother.smooth(t)),n.draw(t)})},t.prototype.draw=function(n){var i=this.xScale,r=this.yScale,o=this.height,e,t;r.domain([0,.5]);var u=this.visitsScale.range([o,0]),s=this,h=d3.svg.line().interpolate("basis").x(function(n){return i(n.day)}).y(function(n){return r(n.Subs/n.Visits)}),c=d3.svg.line().interpolate("basis").x(function(n){return i(n.day)}).y(function(n){return u(n.Visits)}),f=s.g.datum(n);f.append("path").attr("class","conv line").attr("d",h),f.append("path").attr("class","visits line").attr("d",c),this.drawXAxis().drawYAxis(this.referrer,!0,"conv"),e=d3.svg.axis().scale(u).orient("right"),t=this.drawCustomYAxis(this.g,e,!1,"visits"),t.group.attr("transform","translate("+this.width+",0)").select(".domain").attr("style","stroke:none"),t.label.text("Visits").attr("transform","translate(-4,42) rotate(-90)")},t}(n.Growth.Graph);t.KenyaGraph=i})(n.Growth||(n.Growth={}));var t=n.Growth})(Dashboard||(Dashboard={}))