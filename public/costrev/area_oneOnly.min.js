var margin={top:20,right:20,bottom:30,left:50},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,parseDate=d3.time.format("%Y-%b-%d").parse,x=d3.time.scale().range([0,width]),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left"),revLine=d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(n){return y(n.cost)}),costLine=d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(n){return y(n.rev)}),area=d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(n){return y(n.cost)}),svgG=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("/costrev/costrev.csv",function(n){var u=this,r=d3.select("#graphs").selectAll("svg").data(n),i,t;r.enter().append("svg"),r.call(function(n){return console.log(n)}),i=n[2],t=["Aug","Sep","Oct","Nov","Dec"].map(function(n){return{date:parseDate("2012-"+n+"-1"),cost:parseInt(i["Cost "+n]),rev:parseInt(i["Rev "+n])}}),xAxis.ticks(5),x.domain(d3.extent(t,function(n){return n.date})),y.domain([d3.min(t,function(n){return Math.min(n.cost,n.rev)}),d3.max(t,function(n){return Math.max(n.cost,n.rev)})]),svgG.datum(t),svgG.append("clipPath").attr("id","clip-below").append("path").attr("d",area.y0(height)),svgG.append("clipPath").attr("id","clip-above").append("path").attr("d",area.y0(0)),svgG.append("path").attr("class","area above").attr("clip-path","url(#clip-above)").attr("d",area.y0(function(n){return y(n.rev)})),svgG.append("path").attr("class","area below").attr("clip-path","url(#clip-below)").attr("d",area),svgG.append("path").attr("class","line").attr("d",revLine),svgG.append("path").attr("class","line sf").attr("d",costLine),svgG.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis),svgG.append("g").attr("class","y axis").call(function(){return console.log("call",arguments),yAxis.apply(u,arguments)}).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("USD")})