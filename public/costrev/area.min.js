var margin={top:20,right:20,bottom:30,left:50},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,parseDate=d3.time.format("%Y-%b-%d").parse,x=d3.time.scale().range([0,width]),xAxis=d3.svg.axis().scale(x).orient("bottom");d3.csv("/costrev/costrev.csv",function(n){var u=this,n=n.map(function(n){var t=n;return{country:n.Country,data:["Aug","Sep","Oct","Nov","Dec"].map(function(n){return{date:parseDate("2012-"+n+"-1"),cost:parseInt(t["Cost "+n]),rev:parseInt(t["Rev "+n])}})}}),e,t,i,r,s,f;xAxis.ticks(5),e=d3.select("#graphs").selectAll("svg").data(n),e.enter().append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),e.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("class",function(n,t){return"main index-"+t}),t=e,i=n.map(function(n){return n.data}),x.domain(d3.extent(i[0],function(n){return n.date})),r=n.map(function(n){var t=d3.scale.linear().range([height,0]);return t.domain([d3.min(n.data,function(n){return Math.min(n.cost,n.rev)}),d3.max(n.data,function(n){return Math.max(n.cost,n.rev)})]),t}),s=d3.scale.linear().range([height,0]),s.domain([d3.min(i[0],function(n){return Math.min(n.cost,n.rev)}),d3.max(i[0],function(n){return Math.max(n.cost,n.rev)})]);var h=function(n){return d3.svg.axis().scale(r[n]).orient("right")},c=function(n){return d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(t){return r[n](t.rev)})},l=function(n){return d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(t){return r[n](t.cost)})},o=_.range(0,i.length).map(function(n){return d3.svg.area().interpolate("basis").x(function(n){return x(n.date)}).y(function(t){return r[n](t.cost)})});for(t.data(i),t.append("clipPath").attr("id","clip-below").append("path").attr("d",function(n,t){return o[t].y0(height).apply(u,arguments)}),t.append("clipPath").attr("id","clip-above").append("path").attr("d",function(n,t){return o[t].y0(0).apply(u,arguments)}),t.append("path").attr("class","area above").attr("clip-path","url(#clip-above)").attr("d",function(n,t){return o[t].y0(function(n){return r[t](n.rev)}).apply(u,arguments)}),t.append("path").attr("class","area below").attr("clip-path","url(#clip-below)").attr("d",function(n,t){return o[t].y0(function(n){return r[t](n.rev)}).apply(u,arguments)}),t.append("path").attr("class","line rev").attr("d",function(n,t){return c(t).apply(u,arguments)}),t.append("path").attr("class","line cost").attr("d",function(n,t){return l(t).apply(u,arguments)}),t.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).append("text").text(function(t,i){return n[i].country}).attr("class","country"),t.append("g").attr("class",function(n,t){return"y axis index-"+t}).attr("transform","translate(0,2)").attr("data-index",function(n,t){return t}).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("USD"),f=0;f<i.length;f++)h(f)(t.selectAll("g.y.axis.index-"+f))})